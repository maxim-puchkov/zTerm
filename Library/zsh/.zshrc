#!/bin/zsh

#
#
#
#
#  User-specific profile for interactive zsh(1) shells.


setopt extendedglob

zmodload -s zsh/{zutil,zprof,zselect}

bindkey '^X\x7f' backward-kill-line  # Command-Delete



#MARK: - Directories
# User home directories
typeset DEV="$HOME/Developer"
typeset PROJ="$HOME/Developer/Projects"
typeset iCloud="$HOME/Library/Mobile Documents/com~apple~CloudDocs"

# Homebrew
typeset HOMEBREW='/usr/local/Homebrew'
typeset CELLAR='/usr/local/Cellar'

# Apache Maven
export M2_HOME='/usr/local/opt/apache-maven'
export M2="$M2_HOME/bin"
export MAVEN_OPTS="-Xms256m -Xmx512m"

# Oh-my-zsh
export ZSH="$ZDOTDIR/.oh-my-zsh"

# Script directories in '/usr/local'
typeset zterm="$ZTERM"
typeset zdot="$ZDOTDIR"





#MARK: - Hashed Directories
# zsh
hash -d ZTERM="$ZTERM"
hash -d zdot="$ZDOTDIR"
hash -d zsh="$ZDOTDIR"
# Documents
hash -d dev="$HOME/Developer"
hash -d docs="$HOME/Documents"
hash -d text="$HOME/var/text"
# iCloud
hash -d iCloud="$HOME/Library/Mobile Documents/com~apple~CloudDocs"
hash -d Access=~iCloud/'Access'
# SFU
hash -d sfu=~iCloud/'SFU'
#
hash -d zs=~zdot/'site-functions'
hash -d zf=~zdot/'functions'
hash -d zc=~zdot/'completions'

hash -d l='/usr/local'
hash -d lb='/usr/local/bin'
hash -d ll='/usr/lolca/lib'

hash -d t='/usr/local/Terminal'





#MARK: - PATH
typeset -aU privatepath=(
  $HOME/private/bin
)
# Directories of executable commands
export -aUT PATH path=(
  $path
  $M2
  $ZTERM/bin
  $privatepath
)
# Excluded PATH:
# /usr/local/sbin
# /usr/local/opt/{curl,python3,llvm,openssl}/bin





#MARK: - FPATH
typeset -aU fprivatepath=(
  $HOME/private/zsh/functions
)
# Directories of Z shell autoload functions
# and function completions
export -aUT FPATH fpath=(
  /usr/local/opt/curl/share/zsh/site-functions
  /usr/local/share/zsh-completions
  $ZDOTDIR/site-functions
  $ZDOTDIR/functions
  $ZDOTDIR/completions
  $ZDOTDIR/autogenerated-completions
  $fprivatepath
  $fpath
)

# Autoload zsh functions
autoload -Uz -- $ZDOTDIR/*{functions,completions}/*
autoload -z  -- $fprivatepath/*





#MARK: - PYTHONPATH
# Directories of executable python scripts
export -aUT PYTHONPATH pythonpath=(
  ~/Library/ApplicationSupport/iTerm2/iterm2env-3.8/versions/3.8.0/lib/python3.8/site-packages
)
# Excluded PYTHONPATH:
# ~/Library/ApplicationSupport/iTerm2/Scripts
# ~/Library/ApplicationSupport/iTerm2/iterm2env/**/python*/site-packages
# ~ZTERM/Python
# /usr/local/lib/python3.7/site-packages/Cryptodome

# Python configuration files (not linked)
#export PYTHONENV=~/.pythonenv
#export PYTHONSTARTUP=~/.pythonstartup



#MARK: - CLASSPATH
export ANTLR='/usr/local/lib/antlr-4.8-complete.jar'
# Directories of Java classes
export -aUT CLASSPATH classpath=(
  .
  $ANTLR
  $classpath
)






## (cd /usr/local/lib && sudo curl -O https://www.antlr.org/download/antlr-4.8-complete.jar )
#export ANTLR='/usr/local/lib/antlr-4.8-complete.jar'
#       ANTLR="/usr/local/lib/antlr-runtime-4.8.jar"









#MARK: - Command Environment Variables
# ls, du
export -i BLOCKSIZE=1024

# grep, pcregrep, pcre2grep
export GREP_COLOR='1;4;31'
export PCRE2GREP_COLOR="$GREP_COLOR"

# Command line editor
export EDITOR=/usr/local/bin/nano

# Interactive history
if [[ -d $ZTERM/var/log ]]; then
  HISTFILE=$ZTERM/var/log/$USER.zsh_history
else
  HISTFILE=$HOME/.zsh_history
fi
export HISTFILE

# gpg
GPG_TTY=$(tty)
export GPG_TTY

# Xcode and Developer Tools
XCODE=${(M)$(xcode-select --print-path)##*.app}
export XCODE


if [[ ! -v ITERM_PROFILE ]]; then
  export ITERM_PROFILE='Term 3: Dark'
fi 



# Oh-my-zsh themes and plugins
typeset -a plugins themes
set -A plugins  ${(@f)"$(<~ZTERM/etc/plugins.oh-my-zsh)"}
set -A themes   ${(@f)"$(<~ZTERM/etc/themes.oh-my-zsh)"}
if [[ ! -v ZSH_THEME ]]; then
  ZSH_THEME="${themes[1]}"
fi










#MARK: - Source Files
# Oh-my-zsh
source $ZSH/oh-my-zsh.sh

# Z shell autosuggestions & syntax highlight
source /usr/local/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
source /usr/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh

# Z shell .z sources
source ~zdot/.zio
source ~zdot/.zalias
source ~zdot/.zutil
source ~zdot/.znetwork
source ~zdot/.zmisc
source ~zdot/.zcomp
source ~zdot/.ztest

# iTerm 2
if [[ -f ~zdot/.iterm2/.iterm2_shell_integration.zsh ]]; then
  source ~zdot/.iterm2/.iterm2_shell_integration.zsh
fi

# User functions
if [[ -f ~/private/zsh/functions/include.zsh ]]; then
  source ~/private/zsh/functions/include.zsh
fi









# Automatically reload autoload functions that
# were modified while Terminal is open
function zsh_update_preexec() {
  # Create separate last-update file for each TTY
  typeset last_update="/tmp/${TTY##*/}_update"
  if [[ ! -e $last_update ]]; then
    touch -- $last_update
    return 0
  fi
  # Find functions
  {
    set -- ${(@f)"$(find -L $zsh_update_dirs \
      -maxdepth 1 -type f -mnewer $last_update)"}
    for found; do
      unset -f -- ${found:t}
      autoload -- ${found:t}
      touch -- $last_update
    done
  } 2>/dev/null
  return "(${#found} == 0)"
}


typeset -a zsh_update_dirs
zsh_update_dirs=($ZDOTDIR/functions $fprivatepath)
preexec_functions+=(zsh_update_preexec)



unalias run-help
autoload -Uz run-help




## Shell startup files
#export ZPROFILE="$ZDOTDIR/.zprofile"
#export ZSHRC="$ZDOTDIR/.zshrc"
#export ZIO="$ZDOTDIR/.zio"
#export ZALIAS="$ZDOTDIR/.zalias"
#export ZEXPORT="$ZDOTDIR/.zexport"
#export ZUTIL="$ZDOTDIR/.zutil"
#export ZNET="$ZDOTDIR/.znetwork"
#export ZMISC="$ZDOTDIR/.zmisc"
#export ZCOMP="$ZDOTDIR/.zcomp"
#export ZTEST="$ZDOTDIR/.ztest"
## User zsh directories
#export zfunc="$zdot/functions"
#export zsitefunc="$zdot/site-functions"
#export zdisabled="$zdot/disabled"
#export zcomp="$zdot/completions"
#export ztest="$zdot/Tests"
#
## SFU
#export SFU="$iCloud/SFU"
#export SFU_USER='mpuchkov'
#export SFU_CSIL='csil-cpu4.cs.surrey.sfu.ca'
#export SFU_MNT="/usr/local/mnt/${SFU_USER}@${SFU_CSIL}"

# https://dev.to/manan30/what-is-the-best-zshrc-config-you-have-seen-14id





#MARK: - Miscellaneous
# Hide variables
#typeset -H _ZSH_AUTOSUGGEST_BIND_COUNTS
#typeset -H ZSH_HIGHLIGHT_STYLES
#typeset -H ZSH_AUTOSUGGEST_ACCEPT_WIDGETS
#typeset -H ZSH_AUTOSUGGEST_PARTIAL_ACCEPT_WIDGETS
#typeset -H ZSH_AUTOSUGGEST_IGNORE_WIDGETS
#typeset -H ZSH_HIGHLIGHT_REVISION
#typeset -H ZSH_AUTOSUGGEST_CLEAR_WIDGETS
