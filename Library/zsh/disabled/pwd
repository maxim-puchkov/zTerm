#!/bin/zsh

#  pwd
#  Z-Function (55)
#
#  Created by Maxim Puchkov on 2020-06-05.
#  Copyright Â© 2020 Maxim Puchkov. All rights reserved.


# <#Function description#>
function pwd() {
    function __pwd() {
        typeset opt=$1
        print $=flags -- "$(builtin pwd $opt)"
    }
    
    typeset -A optlist
    optlist=()
    get-arguments -A optlist -f 'L,P,r' -f 'D' -- $argv
    
    # Output flags
    typeset -a flags
    flags=('-P -l -o')
    if [[ $optlist[-D] ]]; then
        noglob unset optlist[-D]
        flags+=('-D')
    fi
    
    #
    typeset -a result
    typeset dir
    case $#optlist in
        0)  result+=("$(__pwd)")
        ;;
        1)  result+=("$(__pwd ${(k)=optlist})")
        ;;
        *)  for optname optval in ${(kv)optlist}; do
                result+=("%F{2}pwd $optname%f: $(__pwd $=optname)")
            done
        ;;
    esac
    
    
    print $=flags -- $result
    unfunction '__pwd'
    return 0
}
