#!/bin/zsh

#  param
#  Z-Function (87)
#
#  Created by Maxim Puchkov on 2020-07-05.
#  Copyright Â© 2020 Maxim Puchkov. All rights reserved.


# param - print parameters names whose name matches input argument; if
#         $1 is '=' (equals sign), then print names of parameters with
#         value matching input argument.
#
# Examples:
# param '*status'  -  status, pipestatus, ...
# param = '/bin'   -  PATH, path, SHELL, ...
function param() {
  setopt extendedglob
  if [[ $# -eq 0 ]]; then
      return 1
  fi
  
  set -- ${(u)argv}
  local desc
  
  while [[ -n $1 ]]; do
    case $1 in
      # Search for matching value
      (-eq|--equals|'=')
        typeset -m '*' |
        grep -E '^([[:alnum:]]+)=.*'${2}'.*$' |
        cut -d '=' -f1
        shift ;;
      
      (-n|--name)
        typeset +m "$2*"
        shift ;;
      
      # Search for matching name
      (*)
        if [[ -v $1 ]]; then
          desc="${${$(typeset -m $1)#$1=\( }% )}"
          
          print -Pf '%s %s=( %s )\n' -- "${(Pt)1}" "%F{6}$1%f" "$desc"
          print -Pf 'integer %s=%i\n' -- "%F{6}#$1%f" "${(P)#1}"
#          desc="$(typeset $1) #  \${#${1}}=${(P)#1}"
#          echo $desc
        else
          typeset +m "$1*"
        fi
    esac
    shift
  done
  return 0
}
