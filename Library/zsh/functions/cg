#!/bin/zsh

#  cg
#  Z-Function (100)
#
#  Created by Maxim Puchkov on 2020-07-15.
#  Copyright © 2020 Maxim Puchkov. All rights reserved.


typeset name=$1
typeset -a commands
commands=(${(@f)"$(perl -pe 's/^\s+([a-z\-]+)\s+(.+)/\1:"\2"/g' <$2)"})

cat <<EOF
#compdef ${name}

#  _${name}
#  Z shell completion
#
#  Generated on $(date -j +'%F').
#  Copyright © $(date -j +'%Y') Maxim Puchkov. All rights reserved.


function _${name}() {
  typeset -a ${name}_commands
  ${name}_commands=(
    $(print -rl -- $'\t\t'${^commands} | expand -t 2,4)
  )
  _describe ${name}_command ${name}_commands
  return 0
}

_${name} "\$@"
EOF

return 0
