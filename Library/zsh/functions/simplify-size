#!/bin/zsh

#  simplify-size
#  Z-Function (125)
#
#  Created by Maxim Puchkov on 2020-09-16.
#  Copyright Â© 2020 Maxim Puchkov. All rights reserved.


# Convert bytes to gigabytes, megabytes, or kilobytes.
function simplify-size() {
#  setopt noglob
  
  while [[ -n "$1" ]]; do
    typeset sign=''
    if [[ ${1[1]} == '-' ]]; then
      sign='-'
    fi
    typeset -i size_bytes=${${1#-}:=0}
    typeset -F1 KB MB GB
    typeset -F1 size=$size_bytes
    typeset unit='B'
    let KB=1024
    let MB="$KB*$KB"
    let GB="$KB*$KB*$KB"
    
    
    case 1 in
      # Gigabyte
      ($(( size_bytes >= $GB )))
        let size=$size_bytes/$GB
        unit='GB'
      ;;
      # Megabyte
      ($(( size_bytes >= $MB )))
        let size=$size_bytes/$MB
        unit='MB'
      ;;
      # Kilobyte
      ($(( size_bytes >= $KB )))
        let size=$size_bytes/$KB
        unit='KB'
      ;;
    esac
    
    
    printf '%s%i%s' "$sign" $size "$unit"
    if [[ -n $2 ]] || [[ -t 1 ]]; then
      printf '\n'
    fi
 
    shift
  done
  return 0
}
