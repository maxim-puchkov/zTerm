#!/bin/zsh

#  zshenv-reload-files
#  Terminal
#
#  Created by Maxim Puchkov on 2020-04-30.
#  Copyright Â© 2020 Maxim Puchkov. All rights reserved.


# Write all filepaths declared in zshenv with the tag
#   ': ref' to 'source.zsh' configuration file.

# If a file listed in 'source.zsh' is modified while
#   zsh is active, it will be re-sourced.
outfile="$ZTERM/etc/source.zsh"

awk -F '(="\\$ZDOTDIR\/|".*)' \
        '/##: ref/  { print "'$ZDOTDIR'/"$2; }' \
        $ZSHENV > $outfile
code=$?

if [[ $code -ne 0 ]]; then
    echo "${0}[$$]: error $code." >&2
    exit $code
fi

echo "${0}[$$]: REF-tagged files written to $outfile."
exit 0
