#!/bin/zsh

#  keystroke
#  zTerm (id: 59)
#
#  Generated by 'zfn' on 2020-10-23
#  Copyright Â© 2020 Maxim Puchkov. All rights reserved.


# keystroke
#
# Send keystrokes to Terminal.
#
# Usage:
# keystroke [ -code ] [ -[command|shift|control|option] ] text'
emulate -LR zsh
setopt extendedglob

typeset prog="${0#*/}"

if [[ $# -eq 0 ]]; then
  error -1 'no input'
fi

# Options
local -a opts=()
while [[ "$1" =~ ^[-] ]]; do
  case ${1##-#} in
    (code)            prog="keycode"  ;;
    
    (C|cmd|command)   opts+='command' ;;
    (s|shift)         opts+='shift'   ;;
    (c|ctrl|control)  opts+='control' ;;
    (o|opt|option)    opts+='option'  ;;
    (*) break ;;
  esac
  shift
done

# Function
local -a cmd=()
case $0 in
  (keycode) cmd+="key code ${argv}" ;;
  (*) cmd+="keystroke ${(qqq)argv}" ;;
esac

# Modifiers (command, control, option, shift)
local -a modifiers=()
if [[ ${#opts} -gt 0 ]]; then
  modifiers=( ${^opts}' down' )
  cmd+="using {${(j:, :)modifiers}}"
fi

tell -a "System Events" -p "Terminal" "$cmd"
return 0

