#!/bin/zsh

#  keys
#  zTerm (id: 168)
#
#  Generated by 'mkfn' on 2020-10-18
#  Copyright Â© 2020 Maxim Puchkov. All rights reserved.


# keys
#
# Configure and use hotkey commands.
#
# Usage:
# keys list
# keys set [key] [command]
# keys unset [key]
emulate -LR zsh

typeset -g -A keys
setarray -A keys ~share/keys
local key_cmd


keys_write () {
  if [[ ${#keys} -ne 0 ]]; then
    printf '%s\n' "${(@kv)keys}" >~share/keys
  else
    error -1 -m 'keys are not set'
  fi
}
# Set key
keys_set () {
  if [[ ${+keys[$1]} -eq 0 ]]
  then
    keys+=([$1]=$2)
    keys_write
  else
    error -1 -m 'key ${1} is already set'
  fi
}
# Unset key
keys_unset () {
  if [[ ${+keys[$1]} -eq 1 ]]
  then
    unset "keys[$1]"
    keys_write
  else
    error -1 -m 'key ${1} is not set'
  fi
}
# Run
keys_run () {
  if [[ ${+keys[$1]} -eq 1 ]]
  then
    key_cmd=${keys[$1]}
    $=key_cmd
  else
    error -1 -m 'key ${1} is not set'
  fi
}




if [[ $# -eq 0 ]]; then
  print -P -- "%UList of keys%u (${#keys} total):"
  print -nr -c -- ${(ka)keys}
  return 0
fi

local cmd
if [[ ${#1} -eq 1 ]]
then
  cmd='run'
else
  cmd="$1"
  shift
fi

if [[ ${+functions[${0}_${cmd}]} -eq 0 ]]
then
  error -127 '${cmd} is not a command'
fi



${0}_${cmd} $argv
return $?
