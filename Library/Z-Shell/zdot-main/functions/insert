#!/bin/zsh

#  insert
#  zTerm (id: 167)
#
#  Generated by 'mkfn' on 2020-10-18
#  Copyright Â© 2020 Maxim Puchkov. All rights reserved.


# insert
#
# <#Description...#>
#
# Usage:
# insert <#usage...#>
emulate -LR zsh

# `sed' options
## -i :: in-place editing
local -A sed_opts
local -a sed_specs
sed_specs=('i::' 'n' 'l')
if [[ $# -gt 0 ]] &&
   { ! zparseopts -D -K -M -A sed_opts - $sed_specs }; then
  return 1
fi


# `insert' function options
## -a :: insert after
## -b :: insert before
## -f :: file
local -A opts
local -a specs files
specs=('a' 'b' 'f+:-=files')
if [[ $# -gt 0 ]] &&
   { ! zparseopts -D -K -M -A opts - $specs }; then
  return 1
fi
set -A files ${files#-f}

if [[ $# -lt 2 ]]; then
  error -1 -m 'not enough arguments'
fi


local line=$1
local text=$2


local -a cmds
case 1 in
  # -a <line> <text> :: insert text after line
  ${+opts[-a]}) cmds+="/${line}/a\\
${text}/" ;;
  # -b <line> <text> :: insert text before line
  ${+opts[-b]}) cmds+="s/^(.*${line}.*)\$/${text}\n\1/wp" ;;
  # -i
esac


/usr/bin/sed ${(kv)sed_opts} -E -e $cmds $files
