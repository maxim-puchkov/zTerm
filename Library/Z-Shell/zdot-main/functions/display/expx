#!/bin/zsh

#  expx
#  zTerm (id: 135)
#
#  Generated by 'zfn' on 2020-11-05
#  Copyright Â© 2020 Maxim Puchkov. All rights reserved.


# expx
#
# Options:
# -f [flags] :: Set expansion flag :: ( '#' '##' '%' '%%' )
#
# Usage:
# `expx [ -f <flags> ] value
emulate -LR zsh


# Function options
local -A opts
opts=([-f]='#')
local -a specs
specs=(${(k)^opts#-}':')
if [[ $# -gt 0 ]] &&
   {! zparseopts -D -K -M -A opts - $specs}; then
  return 1
fi
local opts

# Function arguments
if [[ $# -lt 2 ]]; then
  error -1 -m 'not enough arguments'
fi

# Value to expand
local value flags expansion result
value=$1
shift
flags=${opts[-f]}

for pattern; do
  # Expand value with current pattern
  expansion="\${\${:-${value}}${flags}${pattern}}"
  eval "result=${expansion}"
  # Print result of expansion
  printf '"%s%s%s" = "%s"\n' \
    "$(println -F1 $value)" "$(println -F3 $flags)" \
    "$(println -F4 -u $pattern)" "$(println -F2 $result)"
done

return 0
