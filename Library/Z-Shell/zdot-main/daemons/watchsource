#!/bin/zsh

#  watchsource
#  /usr/local/zterm/zsh/sources (id: 41)
#
#  Generated by 'ztemplate_apply' (zterm/zsh/sources) on 2020-10-13
#  Copyright Â© 2020 Maxim Puchkov. All rights reserved.


typeset -aTU WATCHEXEC_RENAMED_PATH  renamed
typeset -aTU WATCHEXEC_CREATED_PATH  created
typeset -aTU WATCHEXEC_WRITTEN_PATH  written
typeset -aU changed=($renamed $created $written)


local file='' interpreter=''
for file in ${WATCHEXEC_COMMON_PATH}${^changed}**(-.Ng:zterm:); do
  read interpreter <$file
  
  case $interpreter in
    ('#!'*'zsh')
      local updates_file=/usr/local/zterm/var/run/updates-$
      printf '%i\t[%s] %s: sourcing file "%s".\n'      \
             "$$" "$(date -j +'%F at %T')" "$0" "$file" \
             >>/usr/local/zterm/var/log/watch-source.log
#      print -P -- "%F{1}source $file%f"
      printf '%s\n' $file >>$updates_file
  esac
done


#env | grep -F WATCH
