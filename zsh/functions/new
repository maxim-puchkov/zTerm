#!/bin/zsh

#  new
#  Z-Function (54)
#
#  Created by Maxim Puchkov on 2020-06-04.
#  Copyright Â© 2020 Maxim Puchkov. All rights reserved.


# <#Function description#>
function new() {
    trap "unfunction -m '${0}-*'" EXIT
    function new-file() {
        mkdir -p -- ${1:h}
        touch -- $1
    }
    
    if [[ $# -lt 2 ]]; then
        error -2 'Bad input.'
    fi
    
    typeset filetype=$1
    typeset filepath=${2:a}
    if [[ -e $filepath ]]; then
        error -1 'File $filepath already exists.'
    fi
    
    case $filetype in
        # New executable file
        -e) new-file $filepath
            chmod a+x -- $filepath
            open -a Xcode -- $filepath
            print -P -- "Created new executable: %F{2}${filepath}%f"
        ;;
        # New file
        -f) new-file $filepath
            open -a Xcode -- $filepath
            print -P -- "Created new file: %F{2}${filepath}%f"
        ;;
        # New directory
        -d) mkdir -p -- $filepath
            open -R -- $filepath
            print -P -- "Created new directory: %F{2}${filepath}%f"
        ;;
    esac
    
    if [[ ! -e $filepath ]]; then
        return 1
    fi
    return 0
}
